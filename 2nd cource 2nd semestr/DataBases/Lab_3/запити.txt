
1. Знайти декартовий добуток двох (трьох) таблиць, створених в лабораторній роботі №1, пояснити отриману кількість рядків результуючої таблиці.
SELECT * FROM d1 CROSS JOIN d2;

1. Вивести алфавітні списки прізвищ та ініціалів всіх клієнтів
автозаправної станції, які купили бензин N- го числа.

PREPARE t1 FROM 
'SELECT DISTINCT LastName, CONCAT(LEFT(FirstName, 1), ". ", LEFT(Father, 1), ".") AS Initials 
FROM клієнт 
JOIN продаж ON клієнт.idAccount = продаж.НомерДисконту 
WHERE DATE(продаж.ДатаПродажу) = ?
ORDER BY LastName ASC';
SET @a = '2024-02-19';
EXECUTE t1 USING @a;

2. Для марки бензину 'N' видати максимальну і мінімальну
кількість літрів, куплених за одну покупку зі знижкою M.

PREPARE t2 FROM 
'SELECT МаркаБензину, MAX(КількістьЛітрів_л) AS Максимальна_кількість_літрів, 
MIN(КількістьЛітрів_л) AS Мінімальна_кількість_літрів
FROM продаж 
WHERE МаркаБензину = ? AND НомерДисконту IN 
    (SELECT idAccount FROM клієнт WHERE Percent = ?)
GROUP BY МаркаБензину';
SET @N = 'А-95';
SET @M = '3';
EXECUTE t2 USING @N, @M;

3. Для кожної дати продажів вивести сумарне значення проданого бензину марки 'N' зі знижкою M.

PREPARE t3 FROM 
'SELECT DATE(ДатаПродажу) AS Дата_продажу, 
SUM(КількістьЛітрів_л) AS Сумарна_кількість_проданих_літрів
FROM продаж 
WHERE МаркаБензину = ? AND НомерДисконту IN 
    (SELECT idAccount FROM клієнт WHERE Percent = ?)
GROUP BY DATE(ДатаПродажу)';
SET @N = 'А-95';
SET @M = '3';
EXECUTE t3 USING @N, @M;

4. Для кожного клієнта видати сумарну кількість літрів купленого бензину.

SELECT клієнт.idAccount, CONCAT(LastName, ", ", FirstName) AS ПІБ_клієнта, SUM(продаж.КількістьЛітрів_л) AS Сумарна_кількість_проданих_літрів FROM клієнт JOIN продаж ON клієнт.idAccount = продаж.НомерДисконту GROUP BY клієнт.idAccount;

5. Вивести прізвища клієнтів автозаправної станції, які купили за один раз максимальне кількість літрів бензину.

SELECT LastName, CONCAT(LEFT(FirstName, 1), ". ", LEFT(Father, 1), ".") AS Initials, МаркаБензину, MAX(КількістьЛітрів_л) AS Максимальна_кількість_літрів FROM клієнт JOIN продаж ON клієнт.idAccount = продаж.НомерДисконту WHERE КількістьЛітрів_л = (SELECT MAX(КількістьЛітрів_л) FROM продаж) GROUP BY клієнт.idAccount;

Власні запити:
1. Знайти середню вартість бензину кожного типу за N період

prepare o1 from 'SELECT МаркаБенизну, Round(AVG(ЦінаПродажу_грн),2) AS Середня_вартість
FROM `вартість бензину`
WHERE ДатаВстановленняВартості BETWEEN ? AND ?
GROUP BY МаркаБенизну';
set @a='2024-02-01', @b='2024-03-29';
execute o1 using @a, @b;

2. Знайти топ-5 клієнтів, які придбали найбільше бензину

SELECT клієнт.idAccount, CONCAT(LastName, ", ", FirstName) AS ПІБ_клієнта, 
SUM(продаж.КількістьЛітрів_л) AS Сумарна_кількість_проданих_літрів
FROM клієнт 
JOIN продаж ON клієнт.idAccount = продаж.НомерДисконту
GROUP BY клієнт.idAccount
ORDER BY Сумарна_кількість_проданих_літрів DESC
LIMIT 5;

3. Знайти кількість покупок кожного клієнта за певний період

PREPARE o3 FROM 
'SELECT клієнт.idAccount, CONCAT(LastName, ", ", FirstName) AS ПІБ_клієнта, 
COUNT( DISTINCT продаж.НомерПродажу) AS Кількість_покупок
FROM клієнт 
JOIN продаж ON клієнт.idAccount = продаж.НомерДисконту
WHERE ДатаПродажу BETWEEN ? AND ?
GROUP BY клієнт.idAccount';
SET @start_date = '2024-02-01';
SET @end_date = '2024-03-29';
EXECUTE o3 USING @start_date, @end_date;

